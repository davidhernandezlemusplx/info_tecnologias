<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>mongodb-config</title>
    <style>
        body{font-family:Arial,sans-serif;line-height:1.6;max-width:900px;margin:0 auto;padding:20px;}
        pre{background:#f5f5f5;padding:1em;overflow-x:auto;}
        code{font-family:Consolas,monospace;}
        h1,h2,h3{color:#2c3e50;}
        table{border-collapse:collapse;width:100%;margin:1em 0;}
        th,td{border:1px solid #ddd;padding:8px;text-align:left;}
        th{background-color:#f2f2f2;}
        tr:nth-child(even){background-color:#f9f9f9;}
        a{color:#3498db;text-decoration:none;}
        a:hover{text-decoration:underline;}
        .breadcrumb{background:#f8f9fa;padding:8px 15px;border-radius:4px;margin-bottom:20px;}
        .breadcrumb a{color:#6c757d;}
        .breadcrumb a:hover{color:#0056b3;}
    </style>
</head>
<body><div class="breadcrumb"><a href="../index.html">Inicio</a> / <a href=../index.html>pliegos-tecnicos</a> / <span>bbdd</span></div><h1>Configuración de MongoDB</h1>
<p><img alt="MongoDB Logo" src="../../../images/bbdd/mongodb/mongodb.png" /></p>
<p>Guía detallada para configurar y administrar MongoDB en contenedores Docker.</p>
<h2>Tabla de Contenidos</h2>
<ul>
<li><a href="#configuración-de-mongodb">Configuración de MongoDB</a></li>
<li><a href="#tabla-de-contenidos">Tabla de Contenidos</a></li>
<li><a href="#prerequisitos">Prerequisitos</a></li>
<li><a href="#paso-1-configuración-con-docker-compose">Paso 1: Configuración con Docker Compose</a></li>
<li><a href="#paso-2-iniciar-el-contenedor-mongodb">Paso 2: Iniciar el contenedor MongoDB</a><ul>
<li><a href="#gestión-rápida-con-makefile">Gestión rápida con Makefile</a></li>
</ul>
</li>
<li><a href="#paso-3-conexión-y-operaciones-básicas">Paso 3: Conexión y operaciones básicas</a><ul>
<li><a href="#conectarse-al-servidor-mongodb">Conectarse al servidor MongoDB</a></li>
<li><a href="#comandos-básicos-de-mongodb">Comandos básicos de MongoDB</a></li>
<li><a href="#gestión-de-bases-de-datos">Gestión de bases de datos</a></li>
<li><a href="#gestión-de-colecciones-tablas">Gestión de colecciones (tablas)</a></li>
</ul>
</li>
<li><a href="#configuraciones-recomendadas">Configuraciones recomendadas</a><ul>
<li><a href="#ajustes-de-rendimiento">Ajustes de rendimiento</a></li>
<li><a href="#seguridad">Seguridad</a></li>
<li><a href="#copia-de-seguridad">Copia de seguridad</a></li>
</ul>
</li>
<li><a href="#solución-de-problemas">Solución de problemas</a><ul>
<li><a href="#verificar-estado-del-servicio">Verificar estado del servicio</a></li>
<li><a href="#conectarse-directamente-a-mongodb">Conectarse directamente a MongoDB</a></li>
<li><a href="#verificar-uso-de-recursos">Verificar uso de recursos</a></li>
</ul>
</li>
<li><a href="#enlaces-útiles">Enlaces útiles</a></li>
<li><a href="#volver-a-su-ficha">Volver a su ficha</a></li>
</ul>
<h2>Prerequisitos</h2>
<p>Antes de comenzar, asegúrate de lo siguiente:</p>
<ul>
<li><strong>Docker</strong> está instalado y en ejecución.</li>
<li><strong>Docker Compose</strong> está instalado (se recomienda la versión 2.29.x o superior).</li>
<li><strong>Make</strong> (opcional, pero recomendado para simplificar los comandos).</li>
</ul>
<blockquote>
<p>Puedes utilizar el script de <code>docker_install.sh</code> de la carpeta <code>/resources</code> para instalar ambas cosas en WSL/Ubuntu.</p>
</blockquote>
<h2>Paso 1: Configuración con Docker Compose</h2>
<p>Crea un archivo <code>docker-compose.yml</code> con la siguiente configuración. Puedes encontrar los archivos de configuración en el directorio <code>/resources/bbdd/mongodb/</code>:</p>
<p>docker-compose.yml</p>
<pre><code class="language-yaml">services:
  mongodb:
    image: mongo:latest
    container_name: mongodb
    restart: unless-stopped
    environment:
      MONGO_INITDB_ROOT_USERNAME: admin
      MONGO_INITDB_ROOT_PASSWORD: admin123
      MONGO_INITDB_DATABASE: admin
    ports:
      - &quot;27017:27017&quot;
    volumes:
      - mongodb_data:/data/db

volumes:
  mongodb_data:
</code></pre>
<h2>Paso 2: Iniciar el contenedor MongoDB</h2>
<p>Inicia el contenedor de MongoDB usando Docker Compose. Este comando descarga la imagen (si no está descargada), crea los volúmenes y arranca el servicio.</p>
<pre><code class="language-bash">docker-compose up -d
</code></pre>
<h3>Gestión rápida con Makefile</h3>
<p>Crea un archivo <code>Makefile</code> con los siguientes comandos útiles:</p>
<pre><code class="language-makefile">MONGO_COMPOSE=docker-compose.yml

up:
    docker-compose -f $(MONGO_COMPOSE) up -d

down:
    docker-compose -f $(MONGO_COMPOSE) down

logs:
    docker-compose -f $(MONGO_COMPOSE) logs -f

restart: 
    docker-compose -f $(MONGO_COMPOSE) restart
</code></pre>
<p>Ejecuta los siguientes comandos desde esa carpeta:</p>
<ul>
<li>Levantar MongoDB:</li>
</ul>
<p><code>bash
  make up</code></p>
<ul>
<li>Parar MongoDB:</li>
</ul>
<p><code>bash
  make down</code></p>
<ul>
<li>Reiniciar MongoDB:</li>
</ul>
<p><code>bash
  make restart</code></p>
<ul>
<li>Ver logs:</li>
</ul>
<p><code>bash
  make logs</code></p>
<blockquote>
<p><strong>Nota:</strong> Para usar los comandos <code>make</code>, asegúrate de tener instalado el paquete <code>make</code>.
Puedes instalarlo en sistemas basados en Debian/Ubuntu con:</p>
</blockquote>
<pre><code class="language-bash">sudo apt install make
</code></pre>
<h2>Paso 3: Conexión y operaciones básicas</h2>
<h3>Conectarse al servidor MongoDB</h3>
<pre><code class="language-bash">docker-compose exec mongodb mongosh -u admin -p admin123
</code></pre>
<ul>
<li>salida:</li>
</ul>
<p><img alt="MongoDB" src="../../../images/bbdd/mongodb/mongodb_cli.png" /></p>
<h3>Comandos básicos de MongoDB</h3>
<h4>Gestión de bases de datos</h4>
<pre><code class="language-javascript">// Mostrar todas las bases de datos
show dbs

// Crear o cambiar a una base de datos (se crea al añadir datos)
use mi_base_datos

// Ver base de datos actual
db

// Eliminar base de datos actual (¡Cuidado! Esto borrará todos los datos)
db.dropDatabase()
</code></pre>
<h4>Gestión de colecciones (tablas)</h4>
<pre><code class="language-javascript">// Mostrar todas las colecciones
show collections

// Crear una colección (se crea automáticamente al insertar datos)
// Insertar un documento en la colección 'usuarios'
db.usuarios.insertOne({
  nombre: &quot;Juan Pérez&quot;,
  email: &quot;juan@ejemplo.com&quot;,
  edad: 30,
  activo: true,
  fecha_registro: new Date()
})

// Insertar varios usuarios
db.usuarios.insertMany([
  { nombre: &quot;Ana García&quot;, email: &quot;ana@ejemplo.com&quot;, edad: 25 },
  { nombre: &quot;Carlos López&quot;, email: &quot;carlos@ejemplo.com&quot;, edad: 35 }
])

// Mostrar todos los usuarios
db.usuarios.find()

// Buscar usuarios mayores de 25 años
db.usuarios.find({ edad: { $gt: 25 } })

// Actualizar un usuario
db.usuarios.updateOne(
  { email: &quot;juan@ejemplo.com&quot; },
  { $set: { edad: 31 } }
)

// Eliminar un usuario
db.usuarios.deleteOne({ email: &quot;juan@ejemplo.com&quot; })

// Mostrar estadísticas de la colección
db.usuarios.stats()

// Eliminar la colección (¡Cuidado! Borra todos los datos)
db.usuarios.drop()
</code></pre>
<h2>Configuraciones recomendadas</h2>
<h3>Ajustes de rendimiento</h3>
<pre><code class="language-yaml">services:
  mongodb:
    # ...
    command: &gt;
      --wiredTigerCacheSizeGB 2
      --setParameter maxTransactionLockRequestTimeoutMillis=5000
      --setParameter ttlMonitorEnabled=true
</code></pre>
<h3>Seguridad</h3>
<pre><code class="language-yaml">services:
  mongodb:
    # ...
    environment:
      - MONGO_INITDB_ROOT_USERNAME=admin
      - MONGO_INITDB_ROOT_PASSWORD=contraseña_segura
      - MONGO_INITDB_DATABASE=admin
    command: &gt;
      --auth
      --bind_ip_all
      --enableFreeMonitoring off
</code></pre>
<h3>Copia de seguridad</h3>
<pre><code class="language-bash"># Crear copia de seguridad
mongodump --uri=&quot;mongodb://usuario:contraseña@localhost:27017&quot; --out=/ruta/backup

# Restaurar copia de seguridad
mongorestore --uri=&quot;mongodb://usuario:contraseña@localhost:27017&quot; /ruta/backup
</code></pre>
<h2>Solución de problemas</h2>
<h3>Verificar estado del servicio</h3>
<pre><code class="language-bash">docker-compose ps
docker-compose logs mongodb
</code></pre>
<h3>Conectarse directamente a MongoDB</h3>
<pre><code class="language-bash">docker-compose exec mongodb mongosh -u admin -p admin123
</code></pre>
<h3>Verificar uso de recursos</h3>
<pre><code class="language-bash">docker stats mongodb
</code></pre>
<h2>Enlaces útiles</h2>
<ul>
<li><a href="https://www.mongodb.com/docs/">Documentación oficial de MongoDB</a></li>
<li><a href="https://www.mongodb.com/docs/manual/administration/analyzing-mongodb-performance/">Guía de rendimiento de MongoDB</a></li>
<li><a href="https://www.mongodb.com/docs/manual/administration/security-checklist/">Mejores prácticas de seguridad</a></li>
<li><a href="https://www.mongodb.com/docs/manual/reference/command/">Referencia de comandos MongoDB</a></li>
</ul>
<h2>Volver a su ficha</h2>
<p><a href="../../tecnologias/bbdd/mongodb.html">Volver a la ficha de MongoDB</a></p></body></html>